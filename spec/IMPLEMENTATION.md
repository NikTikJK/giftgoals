# План реализации проекта GiftGoals

Документ описывает практические шаги по реализации проекта GiftGoals на стеке **React SPA + Express + PostgreSQL** в соответствии с требованиями из `spec/PRD.md` и `spec/UX.md`.

## 1. Подготовка репозитория и окружения

- Создать репозиторий с двумя основными частями:
  - `frontend/` — React SPA (Vite + React + TypeScript).
  - `backend/` — Express (Node.js + TypeScript) + доступ к PostgreSQL.
- Настроить базовые инструменты:
  - линтер (ESLint) и форматтер (Prettier) для фронта и бэка;
  - скрипты `dev`, `build`, `test` для каждой части.
- Описать переменные окружения:
  - для бэка: `DATABASE_URL`, секреты JWT/OAuth, базовый порт и т.д.;
  - для фронта: `VITE_API_BASE_URL` (или аналог) для доступа к API.

## 2. База данных и модели

- Выбрать ORM/Query Builder (например, Prisma или Drizzle).
- Спроектировать и описать схемы таблиц (с учётом PRD):
  - `users` — пользователи, данные авторизации и профиля;
  - `wishlists` — вишлисты (владелец, название, описание, дата события, порог «дорогой», slug);
  - `gifts` — подарки (привязка к вишлисту, название, цена, ссылка, тип обычный/дорогой и др.);
  - `reservations` — резервы подарков;
  - `contributions` — вклады в групповой сбор;
  - `suggestions` — предложения подарков (Phase 2);
  - `notifications` — in‑app уведомления.
- Настроить миграции БД и базовый seed (минимальный набор тестовых данных).

## 3. Backend: Express + PostgreSQL

- Настроить Express‑приложение:
  - подключить парсер JSON, CORS (при необходимости), логирование запросов;
  - подключить ORM/Query Builder к PostgreSQL (используя `DATABASE_URL`).
- Реализовать слои:
  - **Auth**:
    - регистрация/логин по email + пароль;
    - вход по Google (OAuth);
    - выдача и проверка JWT/сессий (httpOnly cookie).
  - **Пользователь и профиль**:
    - получение/обновление профиля (имя, email, настройки).
  - **Вишлисты**:
    - CRUD‑операции с проверкой владельца;
    - генерация уникального slug;
    - включение/отключение публичной ссылки.
  - **Подарки**:
    - CRUD внутри вишлиста;
    - автоматическое определение типа (обычный/дорогой) по порогу;
    - логика изменения цены у дорогого подарка с пересчётом цели сбора.
  - **Резервирование**:
    - создание/снятие резерва с проверкой актуального статуса;
    - запрет резерва владельцу и гостю.
  - **Групповой сбор**:
    - создание вкладов с контролем цели (без оверфандинга);
    - логика недобора и продления сбора (связь с датой события).
  - **Публичный доступ**:
    - эндпоинты для получения вишлиста и его подарков по slug;
    - различное поведение по ролям (гость/друг/владелец) на уровне данных.
  - **Уведомления**:
    - запись in‑app уведомлений о резервах, вкладах, недоборе, предложениях (Phase 2);
    - эндпоинт для получения и отметки прочтения.
- Обернуть ключевые операции в транзакции (резервы, вклады) и вернуть консистентные ошибки.

## 4. Frontend: React SPA

- Инициализировать проект (например, `vite create` с шаблоном React + TS).
- Настроить маршрутизацию (React Router или аналог):
  - `/` — лэндинг (опционально);
  - `/auth/login`, `/auth/register`;
  - `/app/wishlists` — кабинет владельца;
  - `/app/wishlists/:id` — детали вишлиста (режим владельца);
  - `/w/:slug` — публичный вишлист для гостя/друга/владельца.
- Реализовать основные экраны:
  - формы регистрации/входа (в том числе модалки из публичного вишлиста);
  - кабинет владельца (список вишлистов, создание/редактирование/удаление);
  - экран деталей вишлиста (управление подарками, просмотр предложений Phase 2);
  - публичный вишлист с разным набором действий по ролям.
- Имплементировать визуальный стиль и UI‑компоненты по `spec/UX.md`:
  - кнопки, поля ввода, бейджи статусов;
  - карточки вишлистов и подарков (обычные/дорогие);
  - прогресс‑бар сборов;
  - модалки подтверждения и формы;
  - тосты и панель уведомлений.
- Организовать слой работы с API:
  - общая обёртка для запросов (axios/fetch) с обработкой ошибок и токенов;
  - хуки/сервисы для каждого доменного модуля (auth, wishlists, gifts, reservations, contributions, notifications).

## 5. Реалтайм и обновление данных

- На MVP реализовать обновление:
  - через периодический polling (например, раз в 5–15 секунд) для ключевых страниц (публичный вишлист, кабинет владельца);
  - либо через SSE, если хостинг это поддерживает и есть возможность держать соединение.
- Обновлять:
  - статусы подарков (свободен/зарезервирован);
  - прогресс сборов;
  - новые уведомления для владельца и друзей.

## 6. Тестирование

- Проработать сценарии на основе раздела 7 PRD и `spec/UX.md`:
  - регистрация/вход с разных точек (из лэндинга, из публичного вишлиста);
  - создание/редактирование/удаление вишлистов и подарков;
  - резервы (успешные и конфликтные случаи);
  - вклады (успешные, переполнение цели, недобор, продление);
  - поведение для гостя/друга/владельца по ссылке.
- Добавить:
  - unit‑тесты для ключевых сервисов бэкенда;
  - базовые интеграционные/энд‑ту‑энд тесты для критичных потоков (регистрация, создание вишлиста, резерв, вклад).

## 7. Деплой и окружения

- Настроить окружения:
  - `development` — локальная разработка;
  - `staging` (по возможности) — тестовый деплой;
  - `production` — боевая среда.
- Деплой:
  - фронтенд: загрузка собранного React SPA на статический хостинг (Vercel/Netlify/Cloudflare Pages и др.);
  - бэкенд + PostgreSQL: деплой на PaaS (Railway/Render/Fly.io), настройка переменных окружения и миграций.
- Выполнить ручной прогон основных сценариев на `staging`/`production` по чеклисту из PRD/UX.

